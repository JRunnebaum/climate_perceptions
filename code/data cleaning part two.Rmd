---
title: "Data cleaning part two"
author: "Laura"
date: "4/19/2021"
output: html_document
---

##This code creates a single column with text responses for some of the questions that have mutiple columns answered in binary format. Responses about region and fishery are contained in the vulnerability code.

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE, error=FALSE)
```

```{r, packages}
library(tidyverse)
library(lubridate)
library(knitr)
library(grDevices)
library(extrafont)
library(ggrepel)
library(ggthemes)
library(ggplot2)
library(grid)
library(RColorBrewer)
library(ggpubr)
library(PNWColors)
library(GGally)
# windowsFonts(Times=windowsFont("Calibri"))
theme_sleek <- function(base_size = 12, base_family = "Calibri") {
  half_line <- base_size/2
  theme_light(base_size = 12, base_family = "Calibri") +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks.length = unit(half_line / 2.2, "pt"),
      strip.background = element_rect(fill = NA, colour = NA),
      strip.text.x = element_text(colour = "black"),
      strip.text.y = element_text(colour = "black"),
      # axis.text = element_text(colour = "grey30"),
      #axis.title = element_text(colour = "grey30"),
      #legend.title = element_text(colour = "grey30"),#, size = rel(0.9)
      legend.title = element_blank(),
      panel.border = element_rect(fill = NA),#, colour = "grey70", size = 1),
      legend.key.size = unit(0.9, "lines"),
      #legend.text = element_text(size = rel(0.7)),#, colour = "grey30"),
      legend.key = element_rect(colour = NA, fill = NA),
      legend.background = element_rect(colour = NA, fill = NA)#,
      #plot.title = element_text(colour = "grey30"),#, size = rel(1),
      #plot.subtitle = element_text(colour = "grey30")#, size = rel(.85),
     
      
    )
}
theme_set(theme_sleek())
options(scipen = 999) #turns off scientific notation
# Depends on dplyr
tickr <- function(
  data, # dataframe
  var, # column of interest
  to # break point definition 
){
  
  VAR <- enquo(var) # makes VAR a dynamic variable
  
  data %>% 
    distinct(!!VAR) %>%
    ungroup(!!VAR) %>% 
    mutate(labels = ifelse(!!VAR %in% seq(to * round(min(!!VAR) / to), max(!!VAR), to),
                           !!VAR, "")) %>%
    select(breaks = UQ(VAR), labels)
}
```

#load data with state additions from data exploration
```{r data}
responses <- read.csv("../data/PNW_decoded_responses_wstate10.Feb.2021.csv")
```
#q8 industry role
#can add in details from open ended responses about other jobs if desired
```{r}

responses$industry_role = rep(NA, length =  nrow(responses))
for(i in 1: nrow(responses)) {
  inrole = ""
  if(responses$captain[i] == 1) {
    inrole = paste(inrole, "captain", sep = "") 
  }
  if(responses$vessel_owner[i] == 1) {
    if(inrole == "") { # have to do extra to not put a , at the beginning
      # if this is the first fishery 
      inrole = paste(inrole, "vessel owner", sep = "")
    } else {
      inrole = paste(inrole, "vessel owner", sep = ", ")
    }
  }
  if(responses$crew[i] == 1) {
    if(inrole == "") {
      inrole = paste(inrole, "crew", sep = "")
    } else {
      inrole = paste(inrole, "crew", sep = ", ")
    }
  }
  if(responses$other_role[i] == 1) {
    if(inrole == "") { 
    inrole = paste(inrole, "other", sep = "")
    #just use "other" for fewer categories
    }else {
      inrole = paste(inrole, "other", sep = ", ")
    }
  }
  responses$industry_role[i] = inrole
}
#add if details wanted about other role  
#if(responses$other_role[i] == 1) {
    #if(inrole == "") { 
    #inrole = paste(inrole, responses$other_role_descrip[i], sep = "")
    #paste in what the person put for "other"
    #}else {
      #inrole = paste(inrole, responses$other_role_descrip[i], sep = ", ")
    #}
  #}
  #responses$industry_role[i] = inrole
#}

```

#q11 gear types
```{r}

responses$gear_type = rep(NA, length =  nrow(responses))
for(i in 1: nrow(responses)) {
  gtype = ""
  if(responses$longline[i] == 1) {
    gtype = paste(gtype, "longline", sep = "") 
  }
  if(responses$midwater_trwl[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "midwater trawl", sep = "")
    } else {
      gtype = paste(gtype, "midwater trawl", sep = ", ")
    }
  }
  if(responses$bottom_trwl[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "bottom trawl", sep = "")
    } else {
      gtype = paste(gtype, "bottom trawl", sep = ", ")
    }
  }
  if(responses$pots[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "pots", sep = "")
    } else {
      gtype = paste(gtype, "pots", sep = ", ")
    }
  }
  if(responses$purse_seine[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "purse seine", sep = "")
    } else {
      gtype = paste(gtype, "purse seine", sep = ", ")
    }
  }
  if(responses$gillnet[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "gillnet", sep = "")
    } else {
      gtype = paste(gtype, "gillnet", sep = ", ")
    }
  }
  if(responses$troll[i] == 1) {
    if(gtype == "") {  
      gtype = paste(gtype, "troll", sep = "")
    } else {
      gtype = paste(gtype, "troll", sep = ", ")
    }
  }
  if(responses$other_gear[i] == 1) {
    if(gtype == "") { 
    gtype = paste(gtype, "other", sep = "")
    #just use "other" for fewer categories
    }else {
      inrole = paste(gtype, "other", sep = ", ")
    }
  }
  responses$gear_type[i] = gtype
}
#add if details wanted about other role  
#if(responses$other_gear[i] == 1) {
    #if(gtype == "") { 
    #gtype = paste(gtype, responses$other_gear_descrip[i], sep = "")
    #paste in what the person put for "other"
    #}else {
      #gtype = paste(gtype, responses$other_gear_descrip[i], sep = ", ")
    #}
  #}
  #responses$gear_type[i] = gtype
#}

```