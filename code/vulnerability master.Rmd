---
title: "Vulnerability master"
author: "Laura"
date: "3/2/2021"
output: html_document
---

##Calculating perceptions of vulnerability based upon the exposure, sensitivity, and adaptive capacity of survey participants.
##saves figures into folder ("../figures/vulnerability)

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE, error=FALSE)
```

```{r, packages}
library(tidyverse)
library(lubridate)
library(knitr)
library(grDevices)
library(extrafont)
library(ggrepel)
library(ggthemes)
library(ggplot2)
library(grid)
library(RColorBrewer)
library(ggpubr)
library(PNWColors)
# windowsFonts(Times=windowsFont("Calibri"))
theme_sleek <- function(base_size = 12, base_family = "Calibri") {
  half_line <- base_size/2
  theme_light(base_size = 12, base_family = "Calibri") +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks.length = unit(half_line / 2.2, "pt"),
      strip.background = element_rect(fill = NA, colour = NA),
      strip.text.x = element_text(colour = "black"),
      strip.text.y = element_text(colour = "black"),
      # axis.text = element_text(colour = "grey30"),
      #axis.title = element_text(colour = "grey30"),
      #legend.title = element_text(colour = "grey30"),#, size = rel(0.9)
      legend.title = element_blank(),
      panel.border = element_rect(fill = NA),#, colour = "grey70", size = 1),
      legend.key.size = unit(0.9, "lines"),
      #legend.text = element_text(size = rel(0.7)),#, colour = "grey30"),
      legend.key = element_rect(colour = NA, fill = NA),
      legend.background = element_rect(colour = NA, fill = NA)#,
      #plot.title = element_text(colour = "grey30"),#, size = rel(1),
      #plot.subtitle = element_text(colour = "grey30")#, size = rel(.85),
     
      
    )
}
theme_set(theme_sleek())
options(scipen = 999) #turns off scientific notation
# Depends on dplyr
tickr <- function(
  data, # dataframe
  var, # column of interest
  to # break point definition 
){
  
  VAR <- enquo(var) # makes VAR a dynamic variable
  
  data %>% 
    distinct(!!VAR) %>%
    ungroup(!!VAR) %>% 
    mutate(labels = ifelse(!!VAR %in% seq(to * round(min(!!VAR) / to), max(!!VAR), to),
                           !!VAR, "")) %>%
    select(breaks = UQ(VAR), labels)
}
```
#load data with state code additions
```{r data}
responses <- read.csv("../data/PNW_decoded_responses_wstate10.Feb.2021.csv")
```

##functions to get likert answers to a 0 to 1 scale 
```{r functions}
#giving exposure a scale of 0 to 1, where a fishery that will be strongly negatively affected by climate change scores a 1. Higher score means higher exposure.
exposure_calc <- function(x){
if(is.na(x)){
  return("NA")
} else if(x == "strong_neg"){
  return(1)
} else if(x == "slight_neg"){
  return(0.75)
} else if(x == "no_effect"){
  return(.5)
} else if (x == "slight_pos"){
  return(.25)
} else if (x == "strong_pos"){
  return(0)
} else if (x == "idk") {
  return("NA")
}
}

#Recoding likert answers on a scale of 0 to 1 where strongly agree equals 1. To be applied for sensitity and adaptive capacity or other applicable situations.
sensitivity_ac <- function(x){
if(is.na(x)){
  return("NA")
} else if(x == "strongly_agree"){
  return(1)
} else if(x == "somewhat_agree"){
  return(.75)
} else if(x == "neutral"){
  return(.5)
} else if (x == "somewhat_disagree"){
  return(.25)
} else if (x == "strongly_disagree"){
  return(0)
} else if (x == "I have not observed any changes") {
  return("NA")
}
}

#Recoding likert in opposite for two inverse adaptive capcity questions, strongly agree equals 1 and higher score equals higher adaptive
ac_scale <- function(x){
if(is.na(x)){
  return("NA")
} else if(x == "strongly_agree"){
  return(0)
} else if(x == "somewhat_agree"){
  return(.25)
} else if(x == "neutral"){
  return(.5)
} else if (x == "somewhat_disagree"){
  return(.75)
} else if (x == "strongly_disagree"){
  return(1)
} else if (x == "I have not observed any changes") {
  return("NA")
}
}
```
##exposure
##changing from likert responses to numbers in order to calculate exposure index
##modify for different fisheries depending on survey region
```{r exposure}
responses <- responses %>% 
  mutate(CPS_warming = sapply(X=responses$CPS_warming, FUN=exposure_calc),
         
         dc_warming = sapply(X=responses$dc_warming, FUN=exposure_calc),
        
         gf_warming = sapply(X=responses$gf_warming, FUN=exposure_calc),
         
         hake_warming = sapply(X=responses$hake_warming, FUN=exposure_calc),
         
         hms_warming = sapply(X=responses$hms_warming, FUN=exposure_calc),
         
         salmon_warming = sapply(X=responses$salmon_warming, FUN=exposure_calc),

         scallop_warming = sapply(X=responses$scallop_warming, FUN=exposure_calc),
        
         urchin_warming = sapply(X=responses$urchin_warming, FUN=exposure_calc),
         
         shrimp_warming = sapply(X=responses$shrimp_warming, FUN=exposure_calc),
         
         squid_warming = sapply(X=responses$squid_warming, FUN=exposure_calc),
         
         other_warming = sapply(X=responses$other_warming, FUN=exposure_calc))
```
##Perceptions of how will climate affect specific fisheries?
```{r average exposure score for each fishery}
fishery_exposure<-responses %>%
        select(CPS_warming, dc_warming, gf_warming, hake_warming, hms_warming, salmon_warming,
        scallop_warming,    urchin_warming, shrimp_warming, squid_warming, other_warming)

#fishery exposure as the average of all the responses for that fishery
fishery_exposure<-as.data.frame(sapply(fishery_exposure, as.numeric))
fishery_avg_exposure<-colMeans(fishery_exposure, na.rm = TRUE)
fishery_avg_exposure<-as.data.frame(fishery_avg_exposure)
fishery_avg_exposure$sd = apply(fishery_exposure, 2, sd, na.rm=TRUE)


#if we consider an inviduals exposure to be the average of their responses for all fisheries
individual_exposure<-rowMeans(fishery_exposure, na.rm = TRUE)
responses$indv_exposure = individual_exposure

```

##sensitivity index
```{r sensitivity calculation}
#q39 Please agree or disagree with statements describing how changes in the environment and fisheries have affected your health and wellbeing

responses <- responses %>% 
  mutate(fish_neg_wellbeing = sapply(X=responses$fish_neg_wellbeing, FUN=sensitivity_ac),
         fish_neg_health = sapply(X=responses$fish_neg_health, FUN = sensitivity_ac),
         fish_neg_mental = sapply(X=responses$fish_neg_mental, FUN = sensitivity_ac),
         fish_increase_stress = sapply(X=responses$fish_increase_stress, FUN = sensitivity_ac),
         env_neg_welbeing = sapply(X=responses$fish_neg_wellbeing, FUN = sensitivity_ac),
         env_neg_health = sapply(X=responses$env_neg_health, FUN = sensitivity_ac),
         env_neg_mental = sapply(X=responses$env_neg_mental, FUN = sensitivity_ac),
         env_increase_stress = sapply(X=responses$env_increase_stress, FUN = sensitivity_ac),
         env_neg_safety = sapply(X=responses$env_neg_safety, FUN = sensitivity_ac))

#if we consider an inviduals sensitivity to be the average of their responses for q39
sens_index<-responses%>%
  select(fish_neg_health, fish_neg_mental, fish_neg_wellbeing, fish_increase_stress, env_neg_health, env_neg_mental, env_neg_safety, env_neg_welbeing, env_increase_stress)
sens_index<-as.data.frame(sapply(sens_index, as.numeric))
responses$indv_sensitivity<-rowMeans(sens_index, na.rm = TRUE)

```

##adaptive capacity
```{r adapative capacity calculation}
#q43 With regard to the future security of yourself, your residential community, or your fishery, please indicate the extent to which you agree or disagree with the following statements. Most statements worded so that agreeing = higher adaptive capacity. r7 and r9 are the inverse, agreeing = lower adaptive capacity. 

#rescoring note where different function is needed
responses <- responses %>% 
  mutate(new_fishery = sapply(X=responses$new_fishery, FUN=sensitivity_ac),
         nat_resource_job = sapply(X=responses$nat_resource_job, FUN=sensitivity_ac),
         other_job = sapply(X=responses$other_job, FUN=sensitivity_ac),
         loan = sapply(X=responses$loan, FUN=sensitivity_ac),
         distance = sapply(X=responses$distance, FUN=sensitivity_ac),
         strong_comm = sapply(X=responses$strong_comm, FUN=sensitivity_ac),
         climate_refugees = sapply(X=responses$climate_refugees, FUN=ac_scale),
         adapt_mgmt = sapply(X=responses$adapt_mgmt, FUN=sensitivity_ac),
         const_reg = sapply(X=responses$const_reg, FUN=ac_scale))

#if we consider an inviduals adaptive capacity to be the average of their responses for q43
ac_index<-responses%>%
  select(new_fishery, nat_resource_job, other_job, loan, distance, strong_comm, climate_refugees, adapt_mgmt, const_reg)
ac_index<-as.data.frame(sapply(ac_index, as.numeric))
responses$indv_ac<-rowMeans(ac_index, na.rm = TRUE)

```
##individual vulnerability
```{r vulnerability}
#putting exposure, sensitivity, and ac together

#invidual risk where r = e + s
#not weighted at all
risk<-cbind(responses$indv_exposure, responses$indv_sensitivity)
responses$indv_risk = rowSums(risk, na.rm = TRUE)

#starting with v = e + s - ac (Cinner 2012)
#same as v = risk - ac
responses$indv_vulnerability = responses$indv_risk - responses$indv_ac

#vulnerability by euclidean distance (Levin and Samhouri 2012)
#risk = sqrt(e^2 + s^2)
#v = sqrt(e^2 + s^2 (1-ac)^2)
responses$risk_euc = sqrt(responses$indv_exposure^2 + responses$indv_sensitivity^2)

#Do inverse of adaptive capacity like Davies (2018) where higher number corresponds to lower adaptive capacity

responses$inverse_ac = 1-responses$indv_ac

#for inverse_ac a higher number equals lower adaptive capacity
#use this for euclidean distance for vulnerability

responses$indv_vulnerability_euc=sqrt(responses$indv_exposure^2 + responses$indv_sensitivity^2 + responses$inverse_ac^2)

#exploring how the two methods compare
#check risk first
risk_rank<-rank(responses$indv_risk, na.last = "keep")
risk_euc_rank<-rank(responses$risk_euc, na.last = "keep")
risk_diff<-risk_rank-risk_euc_rank
risk_rankings<-cbind.data.frame(risk_rank, risk_euc_rank, risk_diff)

#vulnerability differences between methods
vuln_rank<-rank(responses$indv_vulnerability, na.last = "keep")
vuln_euc_rank<-rank(responses$indv_vulnerability_euc, na.last = "keep")
vuln_diff<-vuln_rank-vuln_euc_rank
vuln_rankings<-cbind.data.frame(vuln_rank, vuln_euc_rank, vuln_diff)

#for a small group of individuals, the method makes a big difference
```
#subseting by fishery
```{r make a new column and specify fishery(ies) for each person}

#modifed from code written by Laura Koehn
#use to calculate average vulnerability across a fishery
#modify for each survey

responses$listoffisheries = rep(NA, length =  nrow(responses))
# loop through each person and get what they are fishing for, put in new column
# should list each fishery they fish for
# not beautiful code but works
for(i in 1: nrow(responses)) {
  fisheriesname = ""
  if(responses$CPS[i] == 1) {
    fisheriesname = paste(fisheriesname, "CPS", sep = "") 
  }
  if(responses$dungeness_crab[i] == 1) {
    if(fisheriesname == "") { # have to do extra to not put a , at the beginning
      # if this is the first fishery 
      fisheriesname = paste(fisheriesname, "dungeness crab", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "dungeness crab", sep = ", ")
    }
  }
  if(responses$groundfish[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "groundfish", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "groundfish", sep = ", ")
    }
  }
  if(responses$hake[i] == 1) {
    if(fisheriesname == "") {
    fisheriesname = paste(fisheriesname, "hake", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "hake", sep = ", ")
    }
  }
  if(responses$HMS[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "HMS", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "HMS", sep = ", ")
    }
  }
  if(responses$salmon[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "salmon", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "salmon", sep = ", ")
    }
  }
  if(responses$scallops[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "scallops", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "scallops", sep = ", ")
    }
  }
  if(responses$urchin[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "sea urchin", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "sea urchin", sep = ", ")
    }
  }
  if(responses$shrimp[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "shrimp", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "shrimp", sep = ", ")
    }
  }
  if(responses$squid[i] == 1) {
    if(fisheriesname == "") {
      fisheriesname = paste(fisheriesname, "squid", sep = "")
    } else {
      fisheriesname = paste(fisheriesname, "squid", sep = ", ")
    }
  }
  if(responses$other[i] == 1) {
    if(fisheriesname == "") { 
    fisheriesname = paste(fisheriesname, responses$species[i], sep = "")
    #paste in what the person put for "other"
    }else {
      fisheriesname = paste(fisheriesname, responses$species[i], sep = ", ")
    }
  }
  responses$listoffisheries[i] = fisheriesname
}

### Average across each UNIQUE "fishery" - so if they fish for salmon AND HMS, gets
#treated different than just fishing for salmon
#could use if fuction to pull out whatever "fishery" is desired with this method

fisheryavg = responses %>%
  group_by(listoffisheries) %>%
  dplyr::summarise(exposure_avg = mean(indv_exposure, na.rm = TRUE),
                   sensitivity_avg = mean(indv_sensitivity, na.rm = TRUE),
                   adaptive_avg = mean(indv_ac),
                   vuln_avg = mean(indv_vulnerability),
                   vuln_euc_avg = mean(indv_vulnerability_euc, na.rm = TRUE),
                   count = n()
)
    
```


##average vulnerability by fishery
```{r other ways to subset from Koehn}
#Average across anyone participating in a particular fishery, regardless of what else they participate in
#modify by survey

fisheryavgmatrix = matrix(NA, nrow = 10, ncol = 10)
colnames(fisheryavgmatrix) <- c("fishery", "avg_exposure", "avg_sensitivity", "avg_ac", "ac_sd", "avg_risk", "risk_sd", "avg_risk_euc", "avg_vulnerability", "avg_vulnerabilty_euc")
fisheryavgmatrix[,1] = c("CPS", "dungeness crab", "groundfish", "hake", "HMS",
                         "salmon", "scallops","sea urchin", "shrimp", "squid")

#subset to the fishery and avg vulnerability by people who fish for that fishery
for(i in 1:nrow(fisheryavgmatrix)) {
  index = which(grepl(fisheryavgmatrix[i,1], responses$listoffisheries) == TRUE) 
  #which contain the fishery specified at i, 1 in the matrix
  #so for i = 1, this gives you which rows (which fishermen) fish for CPS
  fisheryavgmatrix[i,2] = mean(responses$indv_exposure[index], na.rm = TRUE)
  fisheryavgmatrix[i,3] = mean(responses$indv_sensitivity[index], na.rm = TRUE)
  fisheryavgmatrix[i,4] = mean(responses$indv_ac[index], na.rm = TRUE)
  fisheryavgmatrix[i,5] = sd(responses$indv_ac[index], na.rm = TRUE)
  fisheryavgmatrix[i,6] = mean(responses$indv_risk[index], na.rm = TRUE)
  fisheryavgmatrix[i,7] = sd(responses$indv_risk[index], na.rm = TRUE)
  fisheryavgmatrix[i,8] = mean(responses$risk_euc[index], na.rm = TRUE)
  fisheryavgmatrix[i,9] = mean(responses$indv_vulnerability[index], na.rm = TRUE)
  fisheryavgmatrix[i,10] = mean(responses$indv_vulnerability_euc[index], na.rm = TRUE)
  #average vulnerability across any fisherman that fishes that fishery -
  #would need to add columns to the matrix and then calculate avg exposure, avg 
  #sensitivity, etc. 
}

#change to a dataframe and to numeric
fishery_summary<-as.data.frame(fisheryavgmatrix)
fishery_summary[,2:10]<-sapply(fishery_summary[,2:10], as.numeric)
```
#use the same method to look at regions
#subseting by region
```{r}

#modify for different surveys

responses$listofregions = rep(NA, length =  nrow(responses))
# loop through each person and get what they are fishing for, put in new column
# should list each fishery they fish for
# not beautiful code but works
for(i in 1: nrow(responses)) {
  regionname = ""
  if(responses$pugetsound_SJF[i] == 1) {
    regionname = paste(regionname, "Puget Sound SJF", sep = "") 
  }
  if(responses$wa_coast[i] == 1) {
    if(regionname == "") { # have to do extra to not put a , at the beginning
      # if this is the first fishery 
      regionname = paste(regionname, "WA coast", sep = "")
    } else {
      regionname = paste(regionname, "WA coast", sep = ", ")
    }
  }
  if(responses$cr[i] == 1) {
    if(regionname == "") {
      regionname = paste(regionname, "Columbia River", sep = "")
    } else {
      regionname = paste(regionname, "Columbia River", sep = ", ")
    }
  }
  if(responses$or_coast[i] == 1) {
    if(regionname == "") {
    regionname = paste(regionname, "OR coast", sep = "")
    } else {
      regionname = paste(regionname, "OR coast", sep = ", ")
    }
  }
  if(responses$norcal[i] == 1) {
    if(regionname == "") {
      regionname = paste(regionname, "Nor Cal", sep = "")
    } else {
      regionname = paste(regionname, "Nor Cal", sep = ", ")
    }
  }
  if(responses$cencal[i] == 1) {
    if(regionname == "") {
      regionname = paste(regionname, "Cen Cal", sep = "")
    } else {
      regionname = paste(regionname, "Cen Cal", sep = ", ")
    }
  }
  if(responses$socal[i] == 1) {
    if(regionname == "") {
      regionname = paste(regionname, "So Cal", sep = "")
    } else {
      regionname = paste(regionname, "So Cal", sep = ", ")
    }
  }
  responses$listofregions[i] = regionname
}


regionavg = responses %>%
  group_by(listofregions) %>%
  dplyr::summarise(exposure_avg = mean(indv_exposure, na.rm = TRUE),
                   sensitivity_avg = mean(indv_sensitivity, na.rm = TRUE),
                   adaptive_avg = mean(indv_ac),
                   vuln_avg = mean(indv_vulnerability),
                   vuln_euc_avg = mean(indv_vulnerability_euc, na.rm = TRUE),
                   count = n()
)
```

##average vulnerability by region
```{r}
#grouped by a single regional fishing area
#modify for different surveys

regionmatrix = matrix(NA, nrow = 7, ncol = 8)
colnames(regionmatrix) <- c("region", "avg_exposure", "avg_sensitivity", "avg_ac", "avg_risk", "avg_vulnerability", "avg_risk_euc", "avg_vulnerability_euc")
regionmatrix[,1] = c("Puget Sound SJF", "WA coast", "Columbia River", "OR coast", "Nor Cal",
                         "Cen Cal", "So Cal")

#subset to the fishery and avg vulnerability by people who fish in that area
for(i in 1:nrow(regionmatrix)) {
  index = which(grepl(regionmatrix[i,1], responses$listofregions) == TRUE) 
  #which contain the fishery specified at i, 1 in the matrix
  #so for i = 1, this gives you which rows (which fishermen) fish for CPS
  regionmatrix[i,2] = mean(responses$indv_exposure[index], na.rm = TRUE)
  regionmatrix[i,3] = mean(responses$indv_sensitivity[index], na.rm = TRUE)
  regionmatrix[i,4] = mean(responses$indv_ac[index], na.rm = TRUE)
  regionmatrix[i,5] = mean(responses$indv_risk[index], na.rm = TRUE)
  regionmatrix[i,6] = mean(responses$indv_vulnerability[index], na.rm = TRUE)
  regionmatrix[i,7] = mean(responses$risk_euc[index], na.rm = TRUE)
  regionmatrix[i,8] = mean(responses$indv_vulnerability_euc[index], na.rm = TRUE)
  #average vulnerability across any fisherman that fishes that fishery -
  #would need to add columns to the matrix and then calculate avg exposure, avg 
  #sensitivity, etc. 
}


#change to a dataframe and to numeric
region_summary<-as.data.frame(regionmatrix)
region_summary[,2:8]<-sapply(region_summary[,2:8], as.numeric)
```

##exploratory figures

##visualizing individual risk (exposure v sensitivity)
```{r risk plot}

risk_plot<-ggplot(responses, aes(x=indv_exposure, y=indv_sensitivity)) +
  geom_point()
risk_plot

ggsave(plot = risk_plot, file = paste0("../figures/vulnerability/risk.png"))

#looking at risk by age
risk_age_plot<-ggplot(responses, aes(x=indv_exposure, y=indv_sensitivity, color = age)) +
  geom_point()
risk_age_plot

ggsave(plot = risk_age_plot, file = paste0("../figures/vulnerability/risk_age.png"))

#risk by how much income you get from fishing
risk_income_plot<-ggplot(responses, aes(x=indv_exposure, y=indv_sensitivity, color = income)) +
  geom_point() +
  ggtitle("Risk and percentage of income from outside of fishing")
risk_income_plot

ggsave(plot = risk_income_plot, file = paste0("../figures/vulnerability/risk_income.png"))

#risk by state
risk_state_plot<-ggplot(responses, aes(x=indv_exposure, y=indv_sensitivity, color = state_code)) +
  geom_point() +
  ggtitle("Risk and state of residence")
risk_state_plot

ggsave(plot = risk_state_plot, file = paste0("../figures/vulnerability/risk_state.png"))
```
##considering average vulnerability based upon fishery participation
```{r vulnerability}

#basic risk vs ac
fishery_vulnerability_plot<-ggplot(fishery_summary, aes(x=avg_ac, y=avg_risk)) +
  geom_point() + xlab("Average Adaptive Capacity") +
  ylab("Average Risk") +
  ggtitle("Average vulnerability of fishery participants") +
  geom_text(label = fishery_summary$fishery, nudge_y = .01)
fishery_vulnerability_plot<-fishery_vulnerability_plot + scale_x_reverse(limits = c(.6, .35))

ggsave(plot = fishery_vulnerability_plot, file = paste0("../figures/vulnerability/fishery_vulnerability.png"))

#using the euclidean distance method
fishery_vulnerability_euc_plot<-ggplot(fishery_summary, aes(x=avg_ac, y=avg_risk_euc)) +
  geom_point() + xlab("Average Adaptive Capacity") +
  ylab("Average Risk") +
  ggtitle("Average vulnerability of fishery participants") +
  geom_text(label = fishery_summary$fishery, nudge_y = .01)
fishery_vulnerability_euc_plot<-fishery_vulnerability_euc_plot + scale_x_reverse(limits = c(.6, .35))

ggsave(plot = fishery_vulnerability_euc_plot, file = paste0("../figures/vulnerability/fishery_vulnerability_euc.png"))
```
##considering average vulnerability based upon region fished
```{r}

#basic risk vs ac plot
region_vulnerability_plot<-ggplot(region_summary, aes(x=avg_ac, y=avg_risk, label = region_summary$region)) +
  geom_point(color = "green") + xlab("Average Adaptive Capacity") +
  ylab("Average Risk") + 
  ggtitle("Average vulnerability of fishing regions") +
  geom_text_repel()
region_vulnerability_plot<-region_vulnerability_plot + scale_x_reverse()

region_vulnerability_plot

ggsave(plot = region_vulnerability_plot, file = paste0("../figures/vulnerability/region_vulnerability.png"))

#plotted with euc method
region_vulnerability_euc_plot<-ggplot(region_summary, aes(x=avg_ac, y=avg_risk_euc, label = region_summary$region)) +
  geom_point(color = "green") + xlab("Average Adaptive Capacity") +
  ylab("Average Risk") + 
  ggtitle("Average vulnerability of fishing regions") +
  geom_text_repel()
region_vulnerability_euc_plot<-region_vulnerability_euc_plot + scale_x_reverse()

region_vulnerability_euc_plot

ggsave(plot = region_vulnerability_euc_plot, file = paste0("../figures/vulnerability/region_vulnerability_euc.png"))
```

#save with vulnerability calculations
```{r}
#change file name as desired
write.csv(responses, paste0("../data/PNW_decoded_vulnerability.csv"))
```