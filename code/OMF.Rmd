---
title: "OMF"
author: "Laura"
date: "2/10/2021"
output: html_document
---

##Investigating responses of dungeness crab fishers for potential use in OMF model.

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE, error=FALSE)
```

```{r, packages}
library(tidyverse)
library(lubridate)
library(knitr)
library(grDevices)
library(extrafont)
library(ggrepel)
library(ggthemes)
library(PNWColors)
library(likert)
library(ggpubr)
# windowsFonts(Times=windowsFont("Calibri"))
theme_sleek <- function(base_size = 12, base_family = "Calibri") {
  half_line <- base_size/2
  theme_light(base_size = 12, base_family = "Calibri") +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks.length = unit(half_line / 2.2, "pt"),
      strip.background = element_rect(fill = NA, colour = NA),
      strip.text.x = element_text(colour = "black"),
      strip.text.y = element_text(colour = "black"),
      # axis.text = element_text(colour = "grey30"),
      #axis.title = element_text(colour = "grey30"),
      #legend.title = element_text(colour = "grey30"),#, size = rel(0.9)
      legend.title = element_blank(),
      panel.border = element_rect(fill = NA),#, colour = "grey70", size = 1),
      legend.key.size = unit(0.9, "lines"),
      #legend.text = element_text(size = rel(0.7)),#, colour = "grey30"),
      legend.key = element_rect(colour = NA, fill = NA),
      legend.background = element_rect(colour = NA, fill = NA)#,
      #plot.title = element_text(colour = "grey30"),#, size = rel(1),
      #plot.subtitle = element_text(colour = "grey30")#, size = rel(.85),
     
      
    )
}
theme_set(theme_sleek())
options(scipen = 999) #turns off scientific notation
# Depends on dplyr
tickr <- function(
  data, # dataframe
  var, # column of interest
  to # break point definition 
){
  
  VAR <- enquo(var) # makes VAR a dynamic variable
  
  data %>% 
    distinct(!!VAR) %>%
    ungroup(!!VAR) %>% 
    mutate(labels = ifelse(!!VAR %in% seq(to * round(min(!!VAR) / to), max(!!VAR), to),
                           !!VAR, "")) %>%
    select(breaks = UQ(VAR), labels)
}
```

```{r data}
#dungycrab <- read.csv("../data/DC_data.csv")

responses<-read.csv("../data/PNW_decoded_vulnerability.csv")

ports<- read.csv("../data/community names.csv")
```

```{r}
#color paletes
pal2<-pnw_palette(name="Sailboat",n=2,type="discrete")
pal3<-pnw_palette(name="Sailboat",n=3,type="discrete")
pal4<-pnw_palette(name="Sailboat",n=4,type="discrete")
pal5<-pnw_palette(name="Sailboat",n=5,type="discrete")
pal6<-pnw_palette(name="Sailboat",n=6,type="discrete")
pal7<-pnw_palette(name="Sailboat",n=7,type="continuous")

```

##subset dungeness crab fishers
```{r Option 1: subset by a fishery}

#creates a dataframe of everyone who fishes in a specific fishery
#index essentially placeholder
#change q1r2 for whatever fishery you want to look at
index = which(responses$dungeness_crab == 1) #q1r2 is fishing for dungeness crab
# if you changed column names, used the appropriate column name
dungycrab = responses[index,]

```

#Responses by State
```{r responses by State}
#update based upon survey region
dungycrab$state <- factor(dungycrab$state, levels = c("Washington", "Oregon", "California"))

responses_by_state_plot <- ggplot(data = dungycrab, aes(x=state))+
  geom_bar(stat = "count", fill=("navy blue"))+
  xlab("State\n")+
  ggtitle("Respondents by State") 

ggsave(plot = responses_by_state_plot, file = paste0("../figures/OMF/response_by_state.png"))

#percentage instead of count
responses_by_state_plot <- ggplot(data = dungycrab, aes(x=state))+
  geom_bar(aes(y = (..count..)/sum(..count..)), fill = c("navy blue"))+
  scale_y_continuous(labels=scales::percent) +
  xlab("State\n")+ ylab("percent") +
  ggtitle("Respondents by State") 

ggsave(plot = responses_by_state_plot, file = paste0("../figures/OMF/percent_response_by_state.png"))

```
#basic info summary
```{r responses for q 3 - 10}

pal<-pnw_palette("Sailboat", 4)

#q3 regions where people fish
regions <-  dungycrab %>%
  select(pugetsound_SJF, wa_coast, cr, or_coast, norcal, cencal, socal) %>%  #other_region is also an option
  gather(region, response) %>% 
  group_by(region)
regions$region <- factor(regions$region, levels = c("pugetsound_SJF", "wa_coast", "cr", "or_coast", "norcal", "cencal", "socal"))
region_plot <- ggplot()+
  geom_col(data = regions, aes(x=region, y = response), fill = "#749dae")+
  xlab("Species\n")+
  ylab("Count\n")+
  ggtitle("Regions Fished\n")

ggsave(plot = region_plot, file = paste0("../figures/OMF/regions_fished.png"))

#q5 how long have you been fishing
dungycrab$yrs_fishing<-factor(dungycrab$yrs_fishing, levels = c("0-5", "5-15", "15-25","25+"))

yrsfishing_plot <- ggplot(data = dungycrab, aes (x=yrs_fishing))+
  geom_bar(fill = pal, position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("How long have you been fishing") 
ggsave(plot = yrsfishing_plot, file = paste0("../figures/OMF/yrsfishing.png"))


#q7 how long have you lived in your current community
dungycrab$yrs_residence<-factor(dungycrab$yrs_residence, levels = c("0-5", "5-15", "15-25","25+"))

yrsresidence_plot <- ggplot(data = dungycrab, aes (x=yrs_residence))+
  geom_bar(fill = pal, position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("How long have you lived in your community") 
ggsave(plot = yrsresidence_plot, file = paste0("../figures/OMF/yrsresidence.png"))

#q8 what is your role in the fishing industry
job <-  dungycrab %>%
  select(captain, vessel_owner, crew, other_role) %>%  
  gather(role, response) %>% 
  group_by(role)
job$role <- factor(job$role, levels = c("captain", "vessel_owner", "crew", "other_role"))
job_plot <- ggplot()+
  geom_col(data = job, aes(x=role, y = response), fill = "#749dae")+
  xlab("Role\n")+
  ylab("Count\n")+
  ggtitle("Industry role\n")

ggsave(plot = job_plot, file = paste0("../figures/OMF/industry_role.png"))

#q10 what length vessel do you work on or operate
dungycrab$vessel <- factor(dungycrab$vessel, levels = c("U25", "26-35", "36-45", "46-55", "56-65", "66+"))

vessel_plot <- ggplot(data = dungycrab, aes(x=vessel))+
  geom_bar(stat = "count")+
  xlab("vessel\n")+
  ggtitle("Respondents by Vessel length") 

ggsave(plot = vessel_plot, file = paste0("../figures/OMF/responses_vessel.png"))

```

##climate affecting fishing ability
```{r}
#q21 Do you think your ability to catch fish has been affected by climate change?

dungycrab$ability <- factor(dungycrab$ability, levels = c("no", "no_obs_change", "yes_neg", "yes_pos"))

cc_ability_plot <- ggplot(data = dungycrab, aes (x=ability))+
  geom_bar(aes(y = (..count..)/sum(..count..)), fill = c("navy blue"))+
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Percent of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Climate change has affected ability to catch fish") 

ggsave(plot = cc_ability_plot, file = paste0("../figures/OMF/abilitytofish.png"))

```

#observations of ocean change
```{r q20 observations of change}
#changes you have observed in the last five years?
obs <- responses %>% 
  select(age, ocean_temp, severe_weather, target_spp)

#q20r1 changes in ocean temperature
obs$ocean_temp <- factor(obs$ocean_temp, levels = c("no_change", "increase", "decrease"))

oceanobs_plot <- ggplot(data = obs, aes (x=ocean_temp))+
  geom_bar(fill = "blue", position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Observations of change in ocean temperature") 

ggsave(plot = oceanobs_plot, file = paste0("../figures/ocean_temp_obs.png"))

#q20r2 changes in severe weather
obs$severe_weather <- factor(obs$severe_weather, levels = c("no_change", "increase", "decrease"))

weatherobs_plot <- ggplot(data = obs, aes (x=severe_weather))+
  geom_bar(fill = "blue", position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Observations of change in severe weather") 

ggsave(plot = weatherobs_plot, file = paste0("../figures/weather_obs.png"))

#q20r3 changes in target species
obs$target_spp <- factor(obs$target_spp, levels = c("no_change", "increase", "decrease"))

targetspp_plot <- ggplot(data = obs, aes (x=target_spp))+
  geom_bar(fill = "blue", position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Observations of change in target species") 

ggsave(plot = targetspp_plot, file = paste0("../figures/targetspp_obs.png"))
```

##comparing all concerns together
```{r}
dc_concerns<-dungycrab %>%
  select(warming_concern, oa_concern, storm_concern, sea_level_concern, weather_concern, h20_quality_concern, algal_concern, habitat_concern, pop_size_concern, bycatch_concern, value_concern, costs_concern, sa_concern, distance_concern, reg_concern, graying_fleet_concern, fish_comm_concern, resid_concern, infrastructure_concern, phsy_health_concern, mental_health_concern, safe_at_sea_concern, family_concern)

#add statements as column headers
dc_concerns_statements<-c(
  "ocean warming",
  "ocean acidification",
  "increases in storms",
  "sea level rise",
  "changing weather patterns",
  "ocean water quality",
  "harmful algal blooms",
  "habitat loss",
  "fish populations",
  "bycatch",
  "landed value",
  "operational costs",
  "stock assessments",
  "increased travel distance",
  "regulations",
  "graying of the fleet",
  "fishing community cohesion",
  "residential community cohesion",
  "infrastructure",
  "physical health",
  "mental health",
  "safety at sea",
  "family")
colnames(dc_concerns)<-dc_concerns_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c("very", "somewhat", "none")
for(i in seq_along(dc_concerns)) {
  dc_concerns[,i] <- factor(dc_concerns[,i], levels=mylevels)
}

total_dc_concerns<-likert(dc_concerns)

total_dc_concerns_likert<-plot(total_dc_concerns, type = "heat")+
  ggtitle("Environmental, social, and operational concerns")

ggsave(plot = total_dc_concerns_likert, file = paste0("../figures/OMF/all_concerns.png"))

```

##likert questions about climate and future of fishing
```{r question 37}
#q37 plotting using likert package

q37<-dungycrab %>%
  select(believe, harm_me, harm_future, leave_fishing, risk, no_point, no_fish)

#add statements as column headers
q37_statements<-c(
  "I believe climate change is occurring",
  "Climate change will harm me personally",
  "Climate change will harm future generations",
  "If I had a choice I would leave fishing",
  "It is a big risk to move into a new fishery",
  "There is no point in preparing for climate change since we don't know exactly what is going to happen",
  "There will not be enough fish to continue to operate in my main fishery in 20 years")
colnames(q37)<-q37_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c('strongly_disagree', 'somewhat_disagree', 'neutral', 'somewhat_agree', 'strongly_agree')
for(i in seq_along(q37)) {
  q37[,i] <- factor(q37[,i], levels=mylevels)
}

future_thoughts<-likert(q37)
summary(future_thoughts)
climate_perspectives<-plot(future_thoughts, colors=c('orange','darkorange', "gray", 'darkblue','blue'))

ggsave(plot = climate_perspectives, height = 7, width = 10, file = paste0("../figures/OMF/climate_perspectives.png"))

#by state
future_thoughts_states<-likert(q37, grouping = dungycrab$state_code)
climate_perspectives_states_plot<-plot(future_thoughts_states, colors=c('orange','darkorange', "gray", 'darkblue','blue'))

ggsave(plot = climate_perspectives_states_plot, height = 12, width = 10, file = paste0("../figures/OMF/climate_perspectives_state.png"))

```

##Have you seen changes in the range of your primary fishery?
```{r range shifts}
#q27
dungycrab$range_change<-factor(dungycrab$range_change, levels = c("yes", "no"))

rangeshift_plot <- ggplot(data = dungycrab, aes (x=range_change))+
  geom_bar(fill = "blue", position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Have you seen range shifts in your primary species") 

ggsave(plot = rangeshift_plot, file = paste0("../figures/OMF/rangeshift.png"))
```

##have you seen changes in the timing of when you fish?
```{r timing shifts}
#q29
dungycrab$timing_change<-factor(dungycrab$timing_change, levels = c("yes", "no"))

timeshift_plot <- ggplot(data = dungycrab, aes (x=timing_change))+
  geom_bar(fill = "blue", position = position_dodge(), stat="count")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 16))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Has the timing of your fishing season changed?") 

ggsave(plot = timeshift_plot, file = paste0("../figures/OMF/timeshift.png"))
```

##anova of vulnerability for vessel length
```{r}
levels(dungycrab$vessel)

library(dplyr)
dungycrab %>%
  group_by(vessel) %>%
  dplyr::summarise(mean = mean(indv_vulnerability),
                   count = n(),
                   sd = sd(indv_vulnerability)
  )
mean(dungycrab$indv_vulnerability)

# Box plots
# Plot weight by group and color by group

crab_vessel_vulnerability<-ggboxplot(dungycrab, x = "vessel", y = "indv_vulnerability",
          color = "vessel", palette = c("#00AFBB", "#E7B800", "#FC4E07", "#00AFBB", "#E7B800", "#FC4E07"),
          order = c("U25", "26-35", "36-45", "46-55", "56-65", "66+"),
          ylab = "vulnerability", xlab = "vessel length")

ggsave(plot = crab_vessel_vulnerability, file = paste0("../figures/OMF/crabvesselvuln.png"))

#read mary's paper and then maybe consolidate groups, not sig when all used
crab_vessel_aov<-aov(indv_vulnerability ~ vessel, data = dungycrab)
summary(crab_vessel_aov)

#repeat but use the euclidean distance calc of vulnerabilty
crab_vessel_eucvulnerability<-ggboxplot(dungycrab, x = "vessel", y = "indv_vulnerability_euc",
          color = "vessel", palette = c("#00AFBB", "#E7B800", "#FC4E07", "#00AFBB", "#E7B800", "#FC4E07"),
          order = c("U25", "26-35", "36-45", "46-55", "56-65", "66+"),
          ylab = "vulnerability", xlab = "vessel length")

ggsave(plot = crab_vessel_eucvulnerability, file = paste0("../figures/OMF/crabvesselvuln_euc.png"))

#read mary's paper and then maybe consolidate groups, not sig when all used
crabeuc_vessel_aov<-aov(indv_vulnerability_euc ~ vessel, data = dungycrab)
summary(crabeuc_vessel_aov)

```
##anova for ac of crab fishers by vessel length
```{r}

crab_vessel_ac<-ggboxplot(dungycrab, x = "vessel", y = "indv_ac",
          color = "vessel", palette = c("#00AFBB", "#E7B800", "#FC4E07", "#00AFBB", "#E7B800", "#FC4E07"),
          order = c("U25", "26-35", "36-45", "46-55", "56-65", "66+"),
          ylab = "adaptive capacity", xlab = "vessel length")

ggsave(plot = crab_vessel_ac, file = paste0("../figures/OMF/crabvesselac.png"))

#anova
crabac_vessel_aov<-aov(indv_ac ~ vessel, data = dungycrab)
summary(crabac_vessel_aov)

```

Looking at some stuff for the QNM - specifically what do crew in DC fishery think about stuff?
```{r}
dungycrab<-responses %>%
  filter(dungeness_crab == "1")

dccrew<-dungycrab %>%
  filter(crew == "1",
         captain == "0",
         vessel_owner == "0")

dccrewplus <- dungycrab %>%
  filter(crew == "1")
```


#################################################################################################################
Section 2 - How do people in different community types think about some of the wellbeing aspects in the survey?


```{r}
#add cleaned port list to responses

responses$port_clean = ports$homeport
```

Organize roughly by typology, come back and revisit this when they are all finalized.
Start with coastal fishing towns.
```{r}
responses$port_clean<-trimws(responses$port_clean)

responses <- responses %>%
  mutate(typology = case_when(port_clean == "Astoria" ~ "cfts",
         port_clean =="Half Moon Bay" ~ "cfts",
         port_clean =="Bodega Bay" ~ "cfts",
         port_clean =="Coos Bay" ~ "cfts",
         port_clean =="Fort Bragg" ~ "cfts",
         #port_clean =="Crescent City" ~ "cfts",
         port_clean =="Eureka" ~ "cfts",
         port_clean =="Half Moon Bay" ~ "cfts",
         #port_clean =="Ilwaco" ~ "cfts",
         #port_clean =="Morro Bay" ~ "cfts",
         port_clean =="Newport" ~ "cfts",
         #port_clean =="Warrenton" ~ "cfts",
        port_clean =="Westport" ~ "cfts",
        port_clean == "La Push/Quileute Reservation" ~ "native",
        port_clean =="Neah Bay" ~ "native",
        port_clean =="Port Gamble Tribal Community" ~ "native",
        port_clean == "Los Angeles" ~ "fcity",
         port_clean =="San Diego" ~ "fcity",
        port_clean =="San Francisco" ~ "fcity",
         port_clean =="Seattle" ~ "fcity",
         port_clean =="Santa Barbara" ~ "fcity",
        port_clean =="Bellingham" ~ "fcity",
        port_clean =="Santa Cruz" ~ "fcity",
        TRUE ~ "other"))

#put into groups, maybe helpful for non likert stuff
cfts<-responses %>%
  filter(port_clean == "Astoria"|
         port_clean =="Brookings"|
         port_clean =="Chinook"|
        port_clean =="Coos Bay"|
         port_clean =="Fort Bragg"|
         port_clean =="Crescent City"|
         port_clean =="Eureka"|
         port_clean =="Half Moon Bay"|
         port_clean =="Ilwaco"|
         port_clean =="Morro Bay"|
         port_clean =="Newport"|
         port_clean =="Warrenton"|
        port_clean =="Westport")

native <- responses %>%
  filter(port_clean == "La Push/Quileute Reservation"|
        port_clean =="Neah Bay"|
        port_clean =="Port Gamble Tribal Community")

cities <-responses %>%
  filter(port_clean == "Los Angeles" |
         port_clean =="San Diego"|
        port_clean =="San Francisco"|
         port_clean =="Seattle"|
         port_clean =="Tacoma")


#places unsure about right now Aberdeen, Albion, anacortes, Bellingham, 

```

##Below is a list of statements that may indicate the degree to which community and individual well-being is sensitive to changes in the health of fisheries and the environment. Please indicate your level of agreement with each statement.
```{r question 40}
#q40 plotting using likert package
#connections indicators in wellbeing framework

q40<-responses %>%
  select(enc_child, identity, comm_support, generation, connect_env, connect_comm)

#add statements as column headers
q40_statements<-c(
  "I would encourage my children to be fishermen",
  "Fishing in important to my identity",
  "Fishermen are supported in my community",
  "I am passing down fishing knowledge to the next generation",
  "I feel a connection to my environment",
  "I feel a connection to my community")
colnames(q40)<-q40_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c('strongly_disagree', 'somewhat_disagree', 'neutral', 'somewhat_agree', 'strongly_agree')
for(i in seq_along(q40)) {
  q40[,i] <- factor(q40[,i], levels=mylevels)
}

connections_types<-likert(q40, grouping = responses$typology)
connections_title<-"Level of agreement with the following statements:"
connections_plot<-plot(connections_types, colors=rev(pnw_palette("Sailboat", 5))) +       
  ggtitle(connections_title)

ggsave(plot = connections_plot, height=7, width=10, file = paste0("../figures/OMF/connections_plot.png"))
```

```{r question 41}
#q41 plotting using likert package
#capabilities indicators in wellbeing framework

q41<-responses %>%
  select(money, plan, job_sat, effective_mgmt, data, find_crew, voice, climate_in_mgmt)

#add statements as column headers
q41_statements<-c(
  "I make enough money to support my family",
  "I am able to plan two years out in the future",
  "I am satisfied with my job",
  "I think the fisheries I participate in are managed effectively",
  "I have access to the data and information I need for successful fishing",
  "I can find qualified crew with the skills they need to do a good job",
  "I have a voice in fisheries management",
  "Climate change should be considered in fisheries management")
colnames(q41)<-q41_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c('strongly_disagree', 'somewhat_disagree', 'neutral', 'somewhat_agree', 'strongly_agree')
for(i in seq_along(q41)) {
  q41[,i] <- factor(q41[,i], levels=mylevels)
}

capabilities<-likert(q41, grouping = responses$typology)
capabilities_title<-"Level of agreement with the following statements:"
capabilities_plot<-plot(capabilities, colors=rev(pnw_palette("Sailboat", 5))) +       
  ggtitle(capabilities_title)

ggsave(plot = capabilities_plot, height=10, width=10, file = paste0("../figures/OMF/capabilities_plot.png"))
```

```{r question 42}
#q42 plotting using likert package
#cross-cutting indicators in wellbeing framework

q42<-responses %>%
  select(equitable, opp_outside, opp_crew)

#add statements as column headers
q42_statements<-c(
  "The fisheries I participate in are managed in an equitable way",
  "There are opportunities for people who are not currently fishing to enter into west coast fisheries",
  "There are opportunities for deckhands and other lower level crew to advance")
colnames(q42)<-q42_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c('strongly_disagree', 'somewhat_disagree', 'neutral', 'somewhat_agree', 'strongly_agree')
for(i in seq_along(q42)) {
  q42[,i] <- factor(q42[,i], levels=mylevels)
}

crosscutting<-likert(q42, grouping = responses$typology)
crosscutting_title<-"Level of agreement with the following statements:"
crosscutting_plot<-plot(crosscutting, 
              colors=rev(pnw_palette("Sailboat", 5))) +       
  ggtitle(crosscutting_title)

ggsave(plot = crosscutting_plot, height=7, width=10, file = paste0("../figures/OMF/crosscutting_plot.png"))
```
##With regard to the future security of yourself, your residential community, or your fishery, please indicate the extent to which you agree or disagree with the following statements:
```{r question 43}
#q43 plotting using likert package
#adaptive capacity indicators

#have to load a version of the data where the ac stuff hasn't been changed to numeric yet
old_responses <- read.csv("../data/PNW_decoded_responses_wstate10.Feb.2021.csv")
old_responses$typology = responses$typology

q43<-old_responses %>%
  select(new_fishery, nat_resource_job, other_job, loan, distance, strong_comm, climate_refugees, adapt_mgmt, const_reg)

q43<-q43 %>%
  mutate(across(everything(), ~ case_when(
    (. == "strongly_disagree" ~ "strongly disagree"),
    (. == "somewhat_disagree" ~ "somewhat disagree"),
    (. == "neutral" ~ "neutral"),
    (. == "somewhat_agree" ~ "somewhat agree"),
    (. == "strongly_agree" ~ "strongly agree")
  )))

#add statements as column headers
q43_statements<-c(
  "I could easily move into a new fishery",
  "I could easily find work in another natural resource industry (aquaculture, forestry, etc.)",
  "I could easily get income not related to natural resource harvest, fishing or otherwise",
  "I could easily get a loan or some other form of financial support",
  "I am confident in my ability to travel further to fish if that is needed",
  "I believe my community has a strong and viable future ahead",
  "I am concerned that climate change may lead to people moving out of my community",
  "I think fisheries management can adapt and respond quickly to changing environmental conditions",
  "I feel constrained in my ability to adapt to changes because of regulations")
colnames(q43)<-q43_statements

#setting the levels
#levels need to be set since each possible answer does not appear in each column
mylevels <- c('strongly disagree', 'somewhat disagree', 'neutral', 'somewhat agree', 'strongly agree')
for(i in seq_along(q43)) {
  q43[,i] <- factor(q43[,i], levels=mylevels)
}

ac_likert<-likert(q43, grouping = old_responses$typology)
ac_likert_title<-"Level of agreement with the following statements:"
ac_likert_plot<-plot(ac_likert, 
              colors=rev(pnw_palette("Sailboat", 5))) +       
  ggtitle(ac_likert_title)+ theme(axis.text = element_text(size = 12))

ggsave(plot = ac_likert_plot, height=12, width=10, file = paste0("../figures/OMF/ac_likert_plot.png"))
```

Number of fisheries and types of communities
```{r}

num_fisheries <- ggplot(responses, aes(x=typology, fill = num_fisheries))+
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  scale_fill_manual(values = pal4) +
  xlab("Number of fisheries\n")+
  ggtitle("Fishery participation in different community typologies") 

ggsave(plot = num_fisheries, file = paste0("../figures/OMF/number of fisheries.png"))

```

Percent of income from outside fishing and types of communities
```{r}

income <- ggplot(responses, aes(x=typology, fill = income))+
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  scale_fill_manual(values = pal5) +
  xlab("Percent income from outside fishing\n")+
  ggtitle("Fishery participation in different community typologies") 

ggsave(plot = income, file = paste0("../figures/OMF/pct income outside fishing2.png"))

#example to do percentage, but does percentage of whole group not by type so not super helpful for this
#income <- ggplot(responses, aes(x=income, fill = typology))+
 # geom_bar(position = position_dodge(), aes(y = (..count..)/sum(..count..)))+
  #scale_y_continuous(labels=scales::percent) +
#  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
 # scale_fill_manual(values = pal5) +
#  xlab("Percent income from outside fishing\n")+
 # ggtitle("Fishery participation in different community typologies") 


```

Fish in other parts of the country and types of communities
```{r}

fish_elsewhere <- ggplot(responses, aes(x=typology, fill = other_fisheries))+
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  scale_fill_manual(values = pal4) +
  #xlab("Number of fisheries\n")+
  ggtitle("Fish in other parts of the country") 

ggsave(plot = fish_elsewhere, file = paste0("../figures/OMF/fish other places2.png"))

```

Ability to fish affected by climate change and types of communities
```{r}

fish_climate <- ggplot(responses, aes(x=typology, fill = ability))+
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  scale_y_continuous(labels=scales::percent) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  scale_fill_manual(values = pal4) +
  #xlab("Ability to fish affected by climate change\n")+
  ggtitle("Has your ability to fish been affected by climate change") 

ggsave(plot = fish_climate, file = paste0("../figures/OMF/fishing affected by climate2.png"))

```

#box plot of community type and our vulnerability scores
```{r}
comtype_vuln <- responses %>%
  select(indv_exposure, indv_sensitivity, indv_ac, indv_vulnerability_euc, typology)

comtype_vuln$typology<-as.factor(comtype_vuln$typology)

library(reshape2)
ctv_long<-melt(comtype_vuln, id.vars = "typology")

vuln_box_plot<-ggplot(ctv_long, aes(x=typology, y = value, fill = typology)) + geom_boxplot()+
  facet_wrap(~variable, scale = "free")+
  scale_fill_manual(values = pnw_palette(n=4, name = "Bay", type = "continuous"))

vuln_box_plot

ggsave(plot = vuln_box_plot, height = 7, width = 10, file = paste0("../figures/OMF/vulnerability boxplot.png"))
```
