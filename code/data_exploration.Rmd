---
title: "data exploration"
author: "Jocelyn Runnebaum"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
   word_document:
    reference_docx: word-styles-reference.docx

---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE, error=FALSE)
```

```{r, packages}
library(tidyverse)
library(lubridate)
library(knitr)
library(grDevices)
library(extrafont)
library(ggrepel)
library(ggthemes)
# windowsFonts(Times=windowsFont("Calibri"))
theme_sleek <- function(base_size = 12, base_family = "Calibri") {
  half_line <- base_size/2
  theme_light(base_size = 12, base_family = "Calibri") +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks.length = unit(half_line / 2.2, "pt"),
      strip.background = element_rect(fill = NA, colour = NA),
      strip.text.x = element_text(colour = "black"),
      strip.text.y = element_text(colour = "black"),
      # axis.text = element_text(colour = "grey30"),
      #axis.title = element_text(colour = "grey30"),
      #legend.title = element_text(colour = "grey30"),#, size = rel(0.9)
      legend.title = element_blank(),
      panel.border = element_rect(fill = NA),#, colour = "grey70", size = 1),
      legend.key.size = unit(0.9, "lines"),
      #legend.text = element_text(size = rel(0.7)),#, colour = "grey30"),
      legend.key = element_rect(colour = NA, fill = NA),
      legend.background = element_rect(colour = NA, fill = NA)#,
      #plot.title = element_text(colour = "grey30"),#, size = rel(1),
      #plot.subtitle = element_text(colour = "grey30")#, size = rel(.85),
     
      
    )
}
theme_set(theme_sleek())
options(scipen = 999) #turns off scientific notation
# Depends on dplyr
tickr <- function(
  data, # dataframe
  var, # column of interest
  to # break point definition 
){
  
  VAR <- enquo(var) # makes VAR a dynamic variable
  
  data %>% 
    distinct(!!VAR) %>%
    ungroup(!!VAR) %>% 
    mutate(labels = ifelse(!!VAR %in% seq(to * round(min(!!VAR) / to), max(!!VAR), to),
                           !!VAR, "")) %>%
    select(breaks = UQ(VAR), labels)
}
```

```{r load data}
responses <- read.csv("../data/decoded_responses_10.Nov.2020.csv")

belief <- responses %>% 
  select(age, state, state_code, ability, believe, harm_me, harm_future) %>% 
   droplevels() 
```


#Responses by State
```{r responses by State}
#As of 7.27.2020 we only have one response from New Jersey, should we not report data at a level that doesn't have at least 3 observations for the potential of someone accidentally being identified?
responses$state <- factor(responses$state, levels = c("New Jersey","New York", "Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))

responses$state_code <- factor(responses$state_code, levels = c("NJ","NY", "CT", "RI", "MA", "NH", "ME"))

state_dat <- responses %>% 
  group_by(state) %>% 
  summarise(num_responses = n())

responses_by_state_plot <- ggplot(data = responses, aes(x=state_code))+
  geom_bar(stat = "count")+
  xlab("State\n")+
  ggtitle("Respondents by State") 

ggsave(plot = responses_by_state_plot, file = paste0("../figures/response_by_state.png"))

```

##Belief in climate change by State
```{r belief in climate change by State}

belief$believe <- factor(belief$believe, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))

belief <- belief %>% 
  filter(state != "New Jersey",
         state != "New York")

belief_dat <- belief %>%    
  group_by(believe, state) %>%    
  summarise(count = n()) 

belief_dat <- left_join(belief_dat, state_dat) %>% 
  mutate(proportion = count / num_responses)

belief_dat$state <- factor(belief_dat$state, levels = c("Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))

cc_belief_state_plot <- ggplot(data = belief_dat, aes (x=believe, y = proportion, fill = state))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Proportion of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change is occuring (n = 412)") +
  scale_y_continuous(labels = scales::percent)

ggsave(plot = cc_belief_state_plot, file = paste0("../figures/climate_change_belief_state.png"))

```

##Believe that climate change will harm them by State
```{r climate change harm me - state}
#Believe that climate change will harm them personally
belief$harm_me <- factor(belief$harm_me, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))

belief$state <- factor(belief$state, levels = c("New York", "Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))

harm_me_dat <- belief %>%    
  group_by(harm_me, state) %>%    
  summarise(count = n()) 

harm_me_dat <- left_join(harm_me_dat, state_dat) %>% 
  mutate(proportion = count / num_responses)

harm_me_dat$state <- factor(harm_me_dat$state, levels = c("Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))

cc_harm_me_by_state_plot <- ggplot(data = harm_me_dat, aes (x=harm_me, y = proportion, fill = state))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Proportion of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change will harm them personally (n = 412")+
  scale_y_continuous(labels = scales::percent)

ggsave(plot = cc_harm_me_by_state_plot, file = paste0("../figures/climate_change_harm_me_state.png"))

```

##Believe that climate change will harm future generations by State
```{r climate change harm future - state}
#Believe that climate change will harm future generations
belief$harm_future <- factor(belief$harm_future, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))

harm_future_dat <- belief %>%    
  group_by(harm_future, state) %>%    
  summarise(count = n()) 

harm_future_dat$state <- factor(harm_future_dat$state, levels = c("Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))

harm_future_dat <- left_join(harm_future_dat, state_dat) %>% 
  mutate(proportion = count / num_responses)

harm_future_dat$state <- factor(harm_future_dat$state, levels = c("Connecticut", "Rhode Island", "Massachusetts", "New Hampshire", "Maine"))


cc_harm_future_by_state_plot <- ggplot(data = harm_future_dat, aes (x=harm_future, y= proportion, fill = state))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change will harm future generations (n = 412)") +
  scale_y_continuous(labels = scales::percent)
  

ggsave(plot = cc_harm_future_by_state_plot, file = paste0("../figures/climate_change_harm_future_state.png"))

```

#Responses by Age
```{r responses by State}
responses$age <- factor(responses$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))

age_dat <- responses %>% 
  group_by(age) %>% 
  summarise(num_responses = n())

responses_by_age_plot <- ggplot(data = responses, aes(x=age))+
  geom_bar(position = position_dodge(),stat = "count")

ggsave(plot = responses_by_age_plot, file = paste0("../figures/responses_by_age.png"))
```

##Belief in climate change by age
```{r belief in climate change}
belief$believe <- factor(belief$believe, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))
belief$age <- factor(belief$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))

belief_by_age_dat <- belief %>%    
  group_by(believe, age) %>%    
  summarise(count = n())
  

belief_by_age_dat <- left_join(belief_by_age_dat, age_dat) %>% 
  mutate(proportion = count / num_responses)

belief_by_age_dat$age <- factor(belief_by_age_dat$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))


cc_belief_plot <- ggplot(data = belief_by_age_dat, aes (x=believe, y = proportion, fill = age))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+      ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change is occuring") +
  scale_y_continuous(labels = scales::percent)

ggsave(plot = cc_belief_plot, file = paste0("../figures/climate_change_belief_age.png"))

```

##Believe that climate change will harm them by age
```{r climate change harm me - age}
#Believe that climate change will harm them personally
belief$harm_me <- factor(belief$harm_me, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))

harm_me_by_age_dat <- belief %>%    
  group_by(harm_me, age) %>%    
  summarise(count = n())
  

harm_me_by_age_dat <- left_join(harm_me_by_age_dat, age_dat) %>% 
  mutate(proportion = count / num_responses)

harm_me_by_age_dat$age <- factor(harm_me_by_age_dat$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))


cc_harm_me_by_age_plot <- ggplot(data = harm_me_by_age_dat, aes (x=harm_me, y = proportion, fill = age))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change will harm them personally")+
  scale_y_continuous(labels = scales::percent)


ggsave(plot = cc_harm_me_by_age_plot, file = paste0("../figures/climate_change_harm_me_age.png"))

```

##Believe that climate change will harm future generations by age
```{r climate change harm future - age}
#Believe that climate change will harm future generations
belief$harm_future <- factor(belief$harm_future, levels = c("strongly_disagree", "somewhat_disagree", "neutral", "somewhat_agree", "strongly_agree"))

harm_future_by_age_dat <- belief %>%    
  group_by(harm_future, age) %>%    
  summarise(count = n())
  
harm_future_by_age_dat <- left_join(harm_future_by_age_dat, age_dat) %>% 
  mutate(proportion = count / num_responses)

harm_future_by_age_dat$age <- factor(harm_future_by_age_dat$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))

cc_harm_future_by_age_plot <- ggplot(data = harm_future_by_age_dat, aes (x=harm_future, y = proportion, fill = age))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Believe that climate change will harm future generations")+
  scale_y_continuous(labels = scales::percent)

ggsave(plot = cc_harm_future_by_age_plot, file = paste0("../figures/climate_change_harm_future_age.png"))

```


##ability to catch fish has been affected by climate change
```{r ability to catch fish}
#Do you think your ability to catch fish has been affected by climate change?
#This is an interesting plot, it doesn't appear people think that climate change has really impacted their ability to catch fish
#does this mean they think their fishing ability is indepent of climate change?
belief$ability <- factor(belief$ability, levels = c("no", "no_obs_change", "yes_neg", "yes_pos"))

affected_by_age_dat <- belief %>%    
  group_by(ability, age) %>%    
  summarise(count = n())
  
affected_by_age_dat <- left_join(affected_by_age_dat, age_dat) %>% 
  mutate(proportion = count / num_responses)


affected_by_age_dat$age <- factor(affected_by_age_dat$age, levels = c("U30", "30-40", "40-50", "50-60", "60-70", "70+"))

cc_ability_by_age_plot <- ggplot(data = affected_by_age_dat, aes (x=ability, y = proportion, fill = age))+
  geom_bar(position = position_dodge(), stat="identity")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ ylab("Number of Respondents\n")+
  xlab("Category\n")+
  ggtitle("Climate change has affected ability to catch fish")+
  scale_y_continuous(labels = scales::percent)

ggsave(plot = cc_ability_by_age_plot, file = paste0("../figures/climate_change_ability_age.png"))

```


```{r Fishery Participation}
#I was thinking about this as the number of responses by species but people harvest multiple species types, so this just gives us an overview of what fisheries respondents participate in

# select the columns/species you want to include then transform to longform data
species <- responses %>% 
  select(lobster, herring, menhaden, scallop, cod, haddock, pollock, halibut, white_hake, dabs, gray_sole, windowpane, yellowtail, winter_flounder, redfish, monkfish, skates, whiting, red_hake, red_crab, clams, squid, dogfish, summer_flounder, scup, black_seabass, other) %>% 
  gather(species, participation) #transforms the data

#this plot isn't particularly helpful because there are so many species, the groundfish species should probably be lumped together for this to be helpful
fishery_participation_plot <- ggplot()+
  geom_col(data = species, aes(x=species, y=participation))+
  xlab("Species\n")+
  ylab("Count\n")+
  ggtitle("Fishery Participation\n") #not quite sure the best title for this figure

#To look at in table format add up the 1s in participation to get the total count

species_count <- species %>%  
  group_by(species) %>%   # groups by like species
  tally(participation) # adds up all the 1s in the rows


```


